---
import SmartEcosystem from "@/components/SmartEcosystem.astro";
import Areas from "@/components/Areas.astro";
import Service from "@/components/Service.astro";
import Contact from "@/components/Contact.astro";
import Layout from "@/layouts/Layout.astro";

import { useTranslation, slugify } from "@/i18n";
import { translations } from "@/i18n/config";

export async function getStaticPaths() {
  const paths: any[] = [];
  for (const lang of Object.keys(translations)) {
    const t = await (translations as any)[lang]();
    const items = t.NAVBAR.SMART_ECOSYSTEM_ITEMS;
    if (items && Array.isArray(items)) {
      for (const item of items) {
        if (item.TITLE_TEXT) {
          paths.push({ params: { lang, slug: slugify(item.TITLE_TEXT) } });
        }
      }
    }
  }
  return paths;
}

const { lang, slug } = Astro.params;

// Redirigimos a la p치gina de inicio en espa침ol como opci칩n por defecto.
if (!lang) {
  return Astro.redirect('/es/');
}

const t = await useTranslation(lang as any);

const item = t.NAVBAR.SMART_ECOSYSTEM_ITEMS.find(
  (i: any) => slugify(i.TITLE_TEXT) === slug
);

// Si no se encuentra el elemento, redirigir a la p치gina de inicio del idioma actual.
if (!item) {
  return Astro.redirect(`/${lang}/`);
}
---

<Layout title={item.TITLE_TEXT}>
  <SmartEcosystem item={{ TITLE: item.TITLE, DESCRIPTION: item.DESCRIPTION }} />
  <Areas/>
  <Service/>
  <Contact/>
</Layout>
